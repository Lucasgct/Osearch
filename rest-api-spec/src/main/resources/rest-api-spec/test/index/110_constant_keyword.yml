---
setup:
  - do:
      indices.create:
        index: test
        body:
          mappings:
            properties:
              genre:
                type : "constant_keyword"
                "value" : "1"

  - do:
      index:
        index: test
        id: 1
        body: {
          "genre": "1"
        }

  - do:
      index:
        index: test
        id: 2
        body: {
          "genre": 1
        }

  - do:
      indices.refresh:
        index: test

---
# Delete Index when connection is teardown
teardown:
  - do:
      indices.delete:
        index: test

---
"Mappings":
  - skip:
      version: " - 2.13.99"
      reason: "constant_keyword is introduced in 2.14.0"

  - do:
      indices.get_mapping:
        index: test
  - is_true: test.mappings
  - match: { test.mappings.properties.genre.type: constant_keyword }
  - length: { test.mappings.properties.genre: 2 }

---
"Supported queries":
  - skip:
      version: " - 2.13.99"
      reason: "constant_keyword is introduced in 2.14.0 in main branch"

  # Verify Document Count
  - do:
      search:
        body: {
          query: {
            match_all: {}
          }
        }

  - length: { hits.hits: 2 }
  - match: { hits.hits.0._source.genre: "1" }
  - match: { hits.hits.1._source.genre: 1 }
