---
"Help":
  - skip:
      version: " - 7.10.99 , 2.0.0 - "
      reason: "discovered_master added in OpenSearch 1.0.0"
  - do:
      cat.health:
        help: true

  - match:
      $body: |
        /^  epoch         .+ \n
            timestamp     .+ \n
            cluster       .+ \n
            status        .+ \n
            node.total    .+ \n
            node.data     .+ \n
            discovered_master .+ \n
            shards        .+ \n
            pri           .+ \n
            relo          .+ \n
            init          .+ \n
            unassign      .+ \n
            pending_tasks .+ \n
            max_task_wait_time .+ \n
            active_shards_percent .+ \n
        
        $/


---
"Empty cluster":
  - skip:
      version: " - 7.10.99 , 2.0.0 - "
      reason: "discovered_master added in OpenSearch 1.0.0"
  - do:
      cat.health: {}

  - match:
      $body: |
        /^
          ( \d+            \s+ # epoch
            \d\d:\d\d:\d\d \s+ # timestamp
            \S+            \s+ # cluster
            \w+            \s+ # status
            \d+            \s+ # node.total
            \d+            \s+ # node.data
            \w+            \s+ # discovered_master
            \d+            \s+ # shards
            \d+            \s+ # pri
            \d+            \s+ # relo
            \d+            \s+ # init
            \d+            \s+ # unassign
            \d+            \s+ # pending_tasks
            (-|\d+(?:[.]\d+)?m?s) \s+ # max task waiting time
            \d+\.\d+%             # active shards percent
            \n
          )+
        $/

---
"Help - after 2.0.0":
  - skip:
      version: " - 1.4.99"
      reason: "discovered_cluster_manager replaced the old terminology in 2.0.0"
      features: node_selector

  - do:
      cat.health:
        help: true
      node_selector:
        version: "2.0.0 - " # Only send request to nodes in 2.x versions, especially during mixedClusterTest.

  - match:
      $body: |
        /^  epoch         .+ \n
            timestamp     .+ \n
            cluster       .+ \n
            status        .+ \n
            node.total    .+ \n
            node.data     .+ \n
            discovered_cluster_manager .+ \n
            shards        .+ \n
            pri           .+ \n
            relo          .+ \n
            init          .+ \n
            unassign      .+ \n
            pending_tasks .+ \n
            max_task_wait_time .+ \n
            active_shards_percent .+ \n
        
        $/

---
"Empty cluster - after 2.0.0":
  - skip:
      version: " - 1.4.99"
      reason: "discovered_cluster_manager replaced the old terminology in 2.0.0"
      features: node_selector

  - do:
      cat.health: {}
      node_selector:
        version: "2.0.0 - " # Only send request to nodes in 2.x versions, especially during mixedClusterTest.

  - match:
      $body: |
        /^
          ( \d+            \s+ # epoch
            \d\d:\d\d:\d\d \s+ # timestamp
            \S+            \s+ # cluster
            \w+            \s+ # status
            \d+            \s+ # node.total
            \d+            \s+ # node.data
            \w+            \s+ # discovered_cluster_manager
            \d+            \s+ # shards
            \d+            \s+ # pri
            \d+            \s+ # relo
            \d+            \s+ # init
            \d+            \s+ # unassign
            \d+            \s+ # pending_tasks
            (-|\d+(?:[.]\d+)?m?s) \s+ # max task waiting time
            \d+\.\d+%             # active shards percent
            \n
          )+
        $/


---
"With ts parameter":
  - skip:
      version: " - 1.4.99"
      reason: "discovered_cluster_manager replaced the old terminology in 2.0.0"
      features: node_selector

  - do:
      cat.health:
        ts: false
      node_selector:
        version: "2.0.0 - " # Only send request to nodes in 2.x versions, especially during mixedClusterTest.

  - match:
      $body: |
        /^
          ( \S+            \s+ # cluster
            \w+            \s+ # status
            \d+            \s+ # node.total
            \d+            \s+ # node.data
            \w+            \s+ # discovered_cluster_manager
            \d+            \s+ # shards
            \d+            \s+ # pri
            \d+            \s+ # relo
            \d+            \s+ # init
            \d+            \s+ # unassign
            \d+            \s+ # pending_tasks
            (-|\d+(?:[.]\d+)?m?s) \s+ # max task waiting time
            \d+\.\d+%             # active shards percent
            \n
          )+
        $/
