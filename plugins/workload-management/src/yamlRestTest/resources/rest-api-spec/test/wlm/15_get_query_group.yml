"test get QueryGroup API":
  - skip:
      version: " - 2.16.99"
      reason: "QueryGroup WorkloadManagement feature was added in 2.17"

  - do:
      query_group_context:
        body:
          {
            "name": "analytics",
            "resiliency_mode": "monitor",
            "resource_limits": {
              "cpu": 0.4,
              "memory": 0.2
            }
          }

  - match: { name: "analytics" }
  - match: { resiliency_mode: "monitor" }
  - match: { resource_limits.cpu: 0.4 }
  - match: { resource_limits.memory: 0.2 }

  - do:
      query_group_context:
        name: "analytics"

  - match: { query_groups.0.name: "analytics" }
  - match: { query_groups.0.resiliency_mode: "monitor" }
  - match: { query_groups.0.resource_limits.cpu: 0.4 }
  - match: { query_groups.0.resource_limits.memory: 0.2 }

  - do:
      catch: /illegal_argument_exception/
      query_group_context:
        name: "analytics1"

  - do:
      query_group_context:
        body:
          {
            "name": "analytics2",
            "resiliency_mode": "monitor",
            "resource_limits": {
              "cpu": 0.1,
              "memory": 0.1
            }
          }

  - match: { name: "analytics2" }
  - match: { resiliency_mode: "monitor" }
  - match: { resource_limits.cpu: 0.1 }
  - match: { resource_limits.memory: 0.1 }

  - do:
      query_group_context:

  - match: { query_groups.0.name: ["analytics", "analytics2"] }
